# Build image: singularity build --force --fakeroot envBarcodeMiner.sif envBarcodeMiner.def
# on mp2b:
# ml apptainer
# env -i PATH=/usr/bin:/bin /cvmfs/soft.computecanada.ca/easybuild/software/2020/Core/apptainer/1.2.4/bin/singularity build --force --fakeroot envBarcodeMiner.mp2.sif envBarcodeMiner.def
BootStrap: docker
From: ubuntu:22.04

%environment
  export PATH=/opt/dicey/bin:$PATH

%post
	apt-get -y update
	apt-get install -y \
	autoconf build-essential cmake g++ gfortran git \
	libcurl4-gnutls-dev hdf5-tools libboost-date-time-dev \
	libboost-program-options-dev libboost-system-dev \
	libboost-filesystem-dev libboost-iostreams-dev \
	libbz2-dev libhdf5-dev libncurses-dev liblzma-dev libsdsl-dev \
	zlib1g-dev libdeflate-dev python3 python3-pip ncbi-blast+ \
	samtools seqkit

	apt-get clean
	rm -rf /var/lib/apt/lists/*

  pip3 install requests
  pip3 install tqdm
  pip3 install bgzip

	# install dicey
	cd /opt
	git clone --recursive https://github.com/gear-genomics/dicey.git
	cd /opt/dicey/
	make -j 4 STATIC=1 all
	make -j 4 install


